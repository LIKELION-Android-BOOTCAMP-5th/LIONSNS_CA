#  다국어 지원 가이드

Flutter의 `flutter_localizations` 패키지를 사용한 다국어(i18n) 지원 설정 및 사용 가이드입니다.

**난이도**: 초급  
**소요 시간**: 약 30분

---

##  목차

1. [개요](#1-개요)
2. [설정 방법](#2-설정-방법)
3. [ARB 파일 작성](#3-arb-파일-작성)
4. [코드 생성](#4-코드-생성)
5. [코드에서 사용하기](#5-코드에서-사용하기)
6. [새로운 언어 추가](#6-새로운-언어-추가)
7. [새로운 문자열 추가](#7-새로운-문자열-추가)
8. [문제 해결](#8-문제-해결)

---

## 1. 개요

### 다국어 지원이란?

다국어 지원(Internationalization, i18n)은 애플리케이션이 여러 언어를 지원하도록 만드는 과정입니다. Flutter에서는 `flutter_localizations` 패키지와 ARB(Application Resource Bundle) 파일을 사용하여 다국어를 구현합니다.

### 현재 지원 언어

- **한국어 (ko)**: 기본 언어
- **영어 (en)**: 보조 언어

### 사용 기술

- **flutter_localizations**: Flutter SDK에 포함된 다국어 지원 패키지
- **intl**: 국제화 라이브러리
- **ARB 파일**: JSON 형식의 리소스 번들 파일
- **flutter gen-l10n**: ARB 파일에서 Dart 코드 자동 생성

---

## 2. 설정 방법

### 2.1 pubspec.yaml 설정

`pubspec.yaml` 파일에 다음 의존성을 추가합니다:

```yaml
dependencies:
  flutter:
    sdk: flutter
  flutter_localizations:
    sdk: flutter
  intl: ^0.20.2
```

### 2.2 l10n.yaml 설정

프로젝트 루트에 `l10n.yaml` 파일을 생성합니다:

```yaml
arb-dir: lib/l10n
template-arb-file: app_ko.arb
output-localization-file: app_localizations.dart
```

**설명**:
- `arb-dir`: ARB 파일이 위치한 디렉토리
- `template-arb-file`: 기본 언어 ARB 파일 (모든 키의 기준)
- `output-localization-file`: 생성될 Dart 파일 이름

### 2.3 pubspec.yaml에 generate 활성화

`pubspec.yaml`의 `flutter` 섹션에 다음을 추가합니다:

```yaml
flutter:
  generate: true
```

### 2.4 main.dart 설정

`main.dart`에서 `MaterialApp` 또는 `MaterialApp.router`에 다국어 설정을 추가합니다:

```dart
import 'package:flutter/material.dart';
import 'package:lionsns/l10n/app_localizations.dart';

class MyApp extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return MaterialApp.router(
      // 다국어: 다국어 델리게이트 설정
      localizationsDelegates: AppLocalizations.localizationsDelegates,
      // 다국어: 지원하는 언어 목록
      supportedLocales: const [
        Locale('ko', ''),  // 한국어
        Locale('en', ''),  // 영어
      ],
      // ... 나머지 설정
    );
  }
}
```

---

## 3. ARB 파일 작성

### 3.1 ARB 파일이란?

ARB(Application Resource Bundle)는 JSON 형식의 리소스 번들 파일입니다. 각 언어별로 별도의 ARB 파일을 생성합니다.

### 3.2 파일 구조

```
lib/l10n/
├── app_ko.arb          # 한국어 (기본 언어)
└── app_en.arb          # 영어
```

### 3.3 ARB 파일 형식

#### 기본 문자열

```json
{
  "@@locale": "ko",
  "appTitle": "커뮤니티 앱",
  "login": "로그인",
  "logout": "로그아웃"
}
```

#### 설명 추가

```json
{
  "appTitle": "커뮤니티 앱",
  "@appTitle": {
    "description": "앱 제목"
  }
}
```

#### 매개변수가 있는 문자열

```json
{
  "welcomeMessage": "안녕하세요, {name}님!",
  "@welcomeMessage": {
    "description": "환영 메시지",
    "placeholders": {
      "name": {
        "type": "String"
      }
    }
  }
}
```

#### 복수형 처리

```json
{
  "itemCount": "{count, plural, =0{항목 없음} =1{항목 1개} other{항목 {count}개}}",
  "@itemCount": {
    "description": "항목 개수",
    "placeholders": {
      "count": {
        "type": "int"
      }
    }
  }
}
```

### 3.4 실제 예시 (app_ko.arb)

```json
{
  "@@locale": "ko",
  "appTitle": "커뮤니티 앱",
  "@appTitle": {
    "description": "앱 제목"
  },
  "login": "로그인",
  "logout": "로그아웃",
  "welcomeMessage": "커뮤니티에 오신 것을\n환영합니다!",
  "@welcomeMessage": {
    "description": "환영 메시지"
  },
  "googleLogin": "Google로 로그인",
  "appleLogin": "Apple로 로그인",
  "kakaoLogin": "카카오로 로그인",
  "naverLogin": "네이버로 로그인"
}
```

### 3.5 실제 예시 (app_en.arb)

```json
{
  "@@locale": "en",
  "appTitle": "Community App",
  "@appTitle": {
    "description": "App title"
  },
  "login": "Login",
  "logout": "Logout",
  "welcomeMessage": "Welcome to\nCommunity!",
  "@welcomeMessage": {
    "description": "Welcome message"
  },
  "googleLogin": "Sign in with Google",
  "appleLogin": "Sign in with Apple",
  "kakaoLogin": "Sign in with Kakao",
  "naverLogin": "Sign in with Naver"
}
```

### 3.6 주의사항

1. **모든 ARB 파일에 동일한 키 포함**: 기본 언어(ko)에 있는 모든 키가 다른 언어 파일에도 있어야 합니다.
2. **키 이름 규칙**: 
   - camelCase 사용 (예: `welcomeMessage`)
   - 특수문자 사용 불가
   - 숫자로 시작 불가
3. **@@locale 필수**: 각 ARB 파일의 첫 번째 항목은 `"@@locale": "언어코드"`여야 합니다.

---

## 4. 코드 생성

### 4.1 자동 생성

`pubspec.yaml`에 `generate: true`가 설정되어 있으면, 다음 명령어로 코드를 생성합니다:

```bash
flutter gen-l10n
```

또는 Flutter 명령어 실행 시 자동으로 생성됩니다:

```bash
flutter run
flutter build
```

### 4.2 생성되는 파일

다음 위치에 자동 생성됩니다:

```
.dart_tool/flutter_gen/gen_l10n/
├── app_localizations.dart
├── app_localizations_en.dart
└── app_localizations_ko.dart
```

### 4.3 수동 생성

필요한 경우 수동으로 생성할 수 있습니다:

```bash
flutter gen-l10n
```

---

## 5. 코드에서 사용하기

### 5.1 기본 사용법

#### Widget에서 사용

```dart
import 'package:lionsns/l10n/app_localizations.dart';

class MyWidget extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    // 다국어 객체 가져오기
    final l10n = AppLocalizations.of(context);
    
    return Text(l10n?.login ?? '로그인');
  }
}
```

#### ConsumerWidget에서 사용

```dart
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'package:lionsns/l10n/app_localizations.dart';

class MyWidget extends ConsumerWidget {
  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final l10n = AppLocalizations.of(context);
    
    return Text(l10n?.login ?? '로그인');
  }
}
```

### 5.2 매개변수가 있는 문자열

```dart
final l10n = AppLocalizations.of(context);
Text(l10n?.welcomeMessage('홍길동') ?? '안녕하세요!');
```

### 5.3 복수형 처리

```dart
final l10n = AppLocalizations.of(context);
Text(l10n?.itemCount(5) ?? '항목 5개');
```

### 5.4 안전한 사용 (null 체크)

```dart
final l10n = AppLocalizations.of(context);
if (l10n != null) {
  return Text(l10n.login);
} else {
  return Text('로그인');  // Fallback
}
```

또는 null 병합 연산자 사용:

```dart
final l10n = AppLocalizations.of(context);
return Text(l10n?.login ?? '로그인');
```

### 5.5 실제 사용 예시

```dart
// 버튼
ElevatedButton(
  onPressed: () {},
  child: Text(l10n?.login ?? '로그인'),
)

// AppBar 제목
AppBar(
  title: Text(l10n?.appTitle ?? '커뮤니티 앱'),
)

// 스낵바
ScaffoldMessenger.of(context).showSnackBar(
  SnackBar(
    content: Text(l10n?.profileSaved ?? '프로필이 저장되었습니다'),
  ),
)
```

### 5.6 Clean Architecture에서의 사용

Clean Architecture 프로젝트에서는 주로 Presentation Layer에서 다국어를 사용합니다:

#### View (Screen)에서 사용

```dart
// features/auth/presentation/pages/auth_screen.dart
class AuthScreen extends ConsumerWidget {
  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final l10n = AppLocalizations.of(context);
    
    return Scaffold(
      appBar: AppBar(
        title: Text(l10n?.login ?? '로그인'),
      ),
      body: Column(
        children: [
          ElevatedButton(
            onPressed: () {},
            child: Text(l10n?.googleLogin ?? 'Google로 로그인'),
          ),
        ],
      ),
    );
  }
}
```

#### ViewModel에서 사용 (에러 메시지 등)

ViewModel에서는 직접 다국어를 사용하지 않고, 에러 메시지 등을 View에서 처리합니다.

---

## 6. 새로운 언어 추가

### 6.1 ARB 파일 생성

새로운 언어의 ARB 파일을 생성합니다. 예를 들어 일본어를 추가하려면:

```
lib/l10n/app_ja.arb
```

### 6.2 ARB 파일 내용 작성

기본 언어(ko)의 모든 키를 복사하고 번역합니다:

```json
{
  "@@locale": "ja",
  "appTitle": "コミュニティアプリ",
  "login": "ログイン",
  "logout": "ログアウト",
  "welcomeMessage": "コミュニティへようこそ！",
  "googleLogin": "Googleでログイン",
  "appleLogin": "Appleでログイン",
  "kakaoLogin": "Kakaoでログイン",
  "naverLogin": "Naverでログイン"
}
```

### 6.3 main.dart에 언어 추가

```dart
supportedLocales: const [
  Locale('ko', ''),  // 한국어
  Locale('en', ''),  // 영어
  Locale('ja', ''),  // 일본어 (추가)
],
```

### 6.4 코드 재생성

```bash
flutter gen-l10n
```

---

## 7. 새로운 문자열 추가

### 7.1 기본 언어 ARB 파일에 추가

`lib/l10n/app_ko.arb`에 새로운 키를 추가합니다:

```json
{
  "newFeature": "새로운 기능",
  "@newFeature": {
    "description": "새로운 기능 설명"
  }
}
```

### 7.2 다른 언어 ARB 파일에 번역 추가

`lib/l10n/app_en.arb`에 번역을 추가합니다:

```json
{
  "newFeature": "New Feature",
  "@newFeature": {
    "description": "New feature description"
  }
}
```

### 7.3 코드 재생성

```bash
flutter gen-l10n
```

### 7.4 코드에서 사용

```dart
final l10n = AppLocalizations.of(context);
Text(l10n?.newFeature ?? '새로운 기능');
```

---

## 8. 문제 해결

### 8.1 코드 생성 오류

**문제**: `flutter gen-l10n` 실행 시 오류 발생

**해결**:
1. ARB 파일의 JSON 형식 확인 (쉼표, 따옴표 등)
2. 모든 ARB 파일에 동일한 키가 있는지 확인
3. `l10n.yaml` 설정 확인

### 8.2 다국어가 적용되지 않음

**문제**: 앱에서 다국어가 표시되지 않음

**해결**:
1. `main.dart`에 `localizationsDelegates`와 `supportedLocales` 설정 확인
2. `AppLocalizations.of(context)`가 null을 반환하지 않는지 확인
3. 디바이스 언어 설정 확인

### 8.3 특정 언어가 표시되지 않음

**문제**: 특정 언어로 변경해도 기본 언어만 표시됨

**해결**:
1. 해당 언어의 ARB 파일이 올바른 위치에 있는지 확인
2. ARB 파일의 `@@locale` 값이 올바른지 확인
3. `supportedLocales`에 해당 언어가 포함되어 있는지 확인

### 8.4 코드에서 null 반환

**문제**: `AppLocalizations.of(context)`가 null을 반환

**해결**:
1. `MaterialApp` 또는 `MaterialApp.router`에 `localizationsDelegates` 설정 확인
2. `context`가 올바른 위젯 트리 내에 있는지 확인
3. null 병합 연산자(`??`)를 사용하여 Fallback 제공

### 8.5 ARB 파일 키 누락 오류

**문제**: 코드 생성 시 "Missing key" 오류

**해결**:
1. 모든 ARB 파일에 동일한 키가 있는지 확인
2. 기본 언어(ko) 파일의 모든 키가 다른 언어 파일에도 있는지 확인
3. 키 이름의 오타 확인

---

## 9. 모범 사례

### 9.1 키 네이밍 규칙

- **명확한 이름 사용**: `btnLogin`보다 `loginButton`이 더 명확
- **계층적 구조**: `authLogin`, `authLogout`처럼 카테고리 접두사 사용
- **일관성 유지**: 프로젝트 전체에서 동일한 네이밍 규칙 사용

### 9.2 설명 추가

모든 키에 `@key` 형식으로 설명을 추가하면 유지보수가 쉬워집니다:

```json
{
  "login": "로그인",
  "@login": {
    "description": "로그인 버튼 텍스트"
  }
}
```

### 9.3 Fallback 처리

항상 null 체크와 Fallback을 제공합니다:

```dart
final l10n = AppLocalizations.of(context);
Text(l10n?.login ?? '로그인');
```

### 9.4 문자열 분리

긴 문자열은 여러 줄로 나누거나 의미 단위로 분리:

```json
{
  "welcomeMessage": "커뮤니티에 오신 것을\n환영합니다!",
  "welcomeSubtitle": "다양한 사람들과 소통해보세요"
}
```

### 9.5 Clean Architecture에서의 다국어 사용

- **Presentation Layer**: View와 ViewModel에서 다국어 사용
- **Domain Layer**: 다국어 사용하지 않음 (순수 비즈니스 로직)
- **Data Layer**: 에러 메시지 등에서 다국어 사용 가능 (하지만 Domain으로 전달 시 문자열로 변환)

---

## 10. 참고 자료

- [Flutter Internationalization 공식 문서](https://docs.flutter.dev/development/accessibility-and-localization/internationalization)
- [ARB 파일 형식](https://github.com/google/app-resource-bundle)
- [intl 패키지 문서](https://pub.dev/packages/intl)

---

## 11. 현재 프로젝트의 다국어 구조

### 지원 언어
- 한국어 (ko) - 기본 언어
- 영어 (en)

### ARB 파일 위치
```
lib/l10n/
├── app_ko.arb          # 한국어
└── app_en.arb          # 영어
```

### 생성된 파일 위치
```
.dart_tool/flutter_gen/gen_l10n/
├── app_localizations.dart
├── app_localizations_ko.dart
└── app_localizations_en.dart
```

### 주요 다국어 키

현재 프로젝트에서 사용 중인 주요 키들:

- **인증**: `login`, `logout`, `googleLogin`, `appleLogin`, `kakaoLogin`, `naverLogin`
- **프로필**: `profile`, `profileEdit`, `profileView`, `profileSaved`
- **게시글**: `post`, `postCreate`, `postEdit`, `postDetail`, `postList`
- **댓글**: `comment`, `commentCreate`, `commentList`
- **좋아요**: `like`, `unlike`, `likedPosts`
- **검색**: `search`, `searchPosts`, `searchUsers`, `searchComments`
- **공통**: `save`, `cancel`, `delete`, `edit`, `loading`, `error`

전체 키 목록은 `lib/l10n/app_ko.arb` 파일을 참고하세요.

